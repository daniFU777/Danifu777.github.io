<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Mi Página Personalizada - DANIFU7777</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <style>
    /* Variables CSS para facilitar cambios de color */
    :root {
      --color-dark-bg: #1A1A1A;
      --color-header-bg: #282828;
      --color-border: #444;
      --color-highlight: #A855F7; /* Morado/Rosado */
      --color-main-bg: #282828; /* Color de fondo principal */
      --color-text: #EAEAEA;
      --color-input-bg: #1F1F1F; /* Fondo para inputs/areas de texto */
      --shadow-light: 0 0 8px rgba(0, 0, 0, 0.5);
      --top-tools-height: 300px; /* ALTURA FIJA PARA CALCULADORA Y GRÁFICO */
      --main-gap: 15px; /* ESPACIO DE SEPARACIÓN EN .MAIN */
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--color-dark-bg);
      color: var(--color-text);
      overflow: hidden; 
    }

    .container {
      display: grid;
      grid-template-columns: 1fr;
      grid-template-rows: auto 1fr;
      height: 100vh;
    }
    
    /* Estilos para la barra superior (header) */
    .top-bar {
      grid-column: 1 / span 2;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 15px;
      background: var(--color-header-bg);
      border-bottom: 2px solid var(--color-highlight);
      box-shadow: 0 3px 6px rgba(0,0,0,0.8);
      z-index: 10;
      position: sticky; 
      top: 0;
    }

    .top-left, .top-right {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    /* Estilos para las cajas de información */
    .box {
      border: 1px solid var(--color-border);
      padding: 4px 10px;
      background: #333;
      border-radius: 4px;
      box-shadow: var(--shadow-light);
      transition: background 0.3s ease;
      font-size: 0.9em;
      white-space: nowrap;
    }

    /* Estilos para el área principal (main) - FLEX CONTAINER */
    .main {
      background: var(--color-main-bg); 
      padding: var(--main-gap);
      display: flex;
      flex-direction: column; 
      gap: var(--main-gap);
      
      /* CRÍTICO: Aseguramos que la altura total es el 100% del espacio restante. */
      height: calc(100vh - 52px); 
      overflow-y: hidden; 
      
      padding-right: calc(30% + 25px); 
    }

    h1 {
      display: none; 
    }
    
    /* --- Contenedor de herramientas superiores (Calculadora + Mini-Gráfico) --- */
    .top-tools-container {
        display: flex;
        gap: 20px;
        /* CRÍTICO: Usamos la altura fija de la variable CSS */
        height: var(--top-tools-height); 
        flex-shrink: 0; 
    }
    
    .tool-panel {
        background: var(--color-input-bg);
        border: 2px solid var(--color-highlight);
        border-radius: 8px;
        padding: 10px;
        box-shadow: var(--shadow-light);
        flex-shrink: 0;
        display: flex;
        flex-direction: column;
    }
    
    .tool-panel h2 {
        color: var(--color-highlight);
        margin-top: 0;
        border-bottom: 1px solid var(--color-border);
        padding-bottom: 5px;
        font-size: 1.2em;
    }

    /* --- Calculadora y Mini-Gráfico --- */
    .calculator-panel {
        width: 300px; 
        flex-shrink: 0; 
    }
    
    .chart-panel {
        flex-grow: 1; 
        overflow: hidden; 
        padding: 0; 
        border: 2px solid var(--color-highlight);
        height: 100%; 
    }
    
    .chart-panel h2 {
        padding: 10px 10px 5px 10px; 
        background: var(--color-input-bg); 
        margin-bottom: 0;
    }

    .chart-iframe {
        width: 100%;
        height: calc(100% - 40px); 
        border: none;
        display: block; 
    }

    /* Grid de la Calculadora - Estilos (Se mantienen igual) */
    .calculator-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 5px;
    }
    #display {
        grid-column: 1 / -1; background: #0D0D0D; color: var(--color-highlight); border: 1px solid var(--color-highlight);
        text-align: right; padding: 8px; margin-bottom: 8px; font-size: 1.8em; overflow: hidden; height: 30px; line-height: 30px;
    }
    .calc-button {
        background: #333; color: var(--color-text); border: 1px solid var(--color-border); padding: 10px 0;
        font-size: 1.1em; cursor: pointer; transition: background 0.1s; border-radius: 4px; user-select: none; 
    }
    .calc-button:nth-child(20) { grid-column: 1 / span 2; }
    .calc-button:nth-child(21) { grid-column: 3 / span 1; }
    .calc-button:nth-child(22) { display: none; }
    .calc-button:nth-child(16) { grid-row: 4 / span 2; grid-column: 4 / span 1;}


    /* --- Estilos del Bloc de Notas MAXIMIZADO --- */
    .notepad-panel {
        /* CRÍTICO: Calculamos la altura restante:
           100% de .main - (altura de top-tools) - (espacio de separación) */
        height: calc(100% - var(--top-tools-height) - var(--main-gap));
        
        flex-grow: 1; 
        background: var(--color-input-bg);
        border: 2px solid var(--color-highlight);
        border-radius: 8px;
        padding: 15px;
        box-shadow: var(--shadow-light);
        display: flex;
        flex-direction: column;
        min-height: 100px; /* Mínimo de seguridad */
    }
    
    .notepad-panel h2 {
        color: var(--color-highlight);
        margin-top: 0;
        border-bottom: 1px solid var(--color-border);
        padding-bottom: 5px;
        font-size: 1.2em;
        flex-shrink: 0; 
    }

    #notepad {
        flex-grow: 1; 
        width: 100%;
        background: var(--color-input-bg);
        color: var(--color-text);
        border: 1px solid var(--color-border);
        padding: 10px;
        resize: none; 
        box-sizing: border-box;
        font-size: 1em;
        line-height: 1.4;
        overflow-y: auto;
    }

    /* Estilos para la barra lateral (aside) - POSICIÓN FIJA */
    .sidebar {
      position: fixed; 
      right: 0;
      top: 52px; 
      bottom: 0; 
      width: 30%; 
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding: 10px;
      background: var(--color-header-bg);
      overflow: hidden; 
      z-index: 5; 
    }

    /* Estilos para los iframes (videos) */
    .sidebar iframe {
      width: 100%;
      height: calc(50% - 5px);
      border: 3px solid var(--color-highlight); 
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(168, 85, 247, 0.4); 
    }

    /* PERSONALIZACIÓN DE BARRAS DE DESPLAZAMIENTO (Morado/Rosa) */
    
    /* Bloc de Notas Scroll */
    #notepad::-webkit-scrollbar { width: 10px; }
    #notepad::-webkit-scrollbar-track { background: var(--color-input-bg); border-radius: 5px; }
    #notepad::-webkit-scrollbar-thumb { background-color: var(--color-highlight); border-radius: 5px; border: 2px solid var(--color-input-bg); }

    /* Media Query para responsividad en pantallas pequeñas (Se mantienen igual) */
    @media (max-width: 900px) {
      .sidebar {
        position: static; width: auto; top: auto; bottom: auto; height: 400px; flex-direction: row;
        overflow-x: auto; border-top: 2px solid var(--color-highlight);
      }
      .container {
        grid-template-columns: 1fr; grid-template-rows: auto 1fr auto; height: auto;
      }
      .main {
        height: auto; overflow-y: visible; padding-right: 15px; 
      }
      .top-tools-container {
        flex-direction: column; max-height: none; height: auto; 
      }
      .calculator-panel {
        width: 100%;
      }
      .notepad-panel {
        /* Vuelve a flex-grow en móvil */
        height: auto;
        flex-grow: 1;
      }
      .sidebar iframe {
        min-width: 80%; height: 100%; flex-shrink: 0; 
      }
      .sidebar::-webkit-scrollbar { height: 8px; }
      .sidebar::-webkit-scrollbar-track { background: var(--color-main-bg); }
      .sidebar::-webkit-scrollbar-thumb { background-color: var(--color-highlight); border-radius: 20px; border: 2px solid var(--color-main-bg); }
    }
  </style>
</head>
<body>
  <audio id="audioPlayer" src="" loop></audio> 

  <div class="container">
    <header class="top-bar">
      <nav class="top-left">
        <div class="box user-info">DANIFU7777</div>
        <div class="box currency-info">ARS/USD: <span id="dolar">Cargando...</span></div>
        
        <div class="box music-control" id="prevBtn" title="Pista Anterior"><i class="fa-solid fa-backward-step"></i> ATRÁS</div>
        <div class="box music-control" id="playPauseBtn" title="Reproducir/Pausa"><i class="fa-solid fa-play"></i> REPRODUCIR</div> 
        <div class="box music-control" id="nextBtn" title="Pista Siguiente"><i class="fa-solid fa-forward-step"></i> ADELANTE</div>
        
        <div class="box song-info">Canción: <span id="song">---</span></div>
      </nav>
      <div class="top-right">
        <div class="box date-time" id="fecha-hora"></div>
      </div>
    </header>

    <main class="main">
      
      <div class="top-tools-container">
          
          <div class="tool-panel calculator-panel">
              <h2>Calculadora</h2>
              <div id="display">0</div>
              <div class="calculator-grid">
                  <button class="calc-button clear" onclick="clearDisplay()">AC</button>
                  <button class="calc-button operator" onclick="appendOperator('/')">/</button>
                  <button class="calc-button operator" onclick="appendOperator('*')">x</button>
                  <button class="calc-button" onclick="backspace()"><i class="fa-solid fa-delete-left"></i></button> 
                  
                  <button class="calc-button" onclick="appendNumber('7')">7</button>
                  <button class="calc-button" onclick="appendNumber('8')">8</button>
                  <button class="calc-button" onclick="appendNumber('9')">9</button>
                  <button class="calc-button operator" onclick="appendOperator('-')">-</button>
                  
                  <button class="calc-button" onclick="appendNumber('4')">4</button>
                  <button class="calc-button" onclick="appendNumber('5')">5</button>
                  <button class="calc-button" onclick="appendNumber('6')">6</button>
                  <button class="calc-button operator" onclick="appendOperator('+')">+</button>
                  
                  <button class="calc-button" onclick="appendNumber('1')">1</button>
                  <button class="calc-button" onclick="appendNumber('2')">2</button>
                  <button class="calc-button" onclick="appendNumber('3')">3</button>
                  <button class="calc-button operator" onclick="calculate()">=</button>
                  
                  <button class="calc-button" onclick="appendNumber('0')">0</button>
                  <button class="calc-button" onclick="appendNumber('.')">.</button>
              </div>
          </div>
          
          <div class="tool-panel chart-panel">
              <h2>Mini-Gráfico (Oro/Dólar XAU/USD)</h2>
              <iframe class="chart-iframe" 
                      src="https://s.tradingview.com/widgetembed/?symbol=OANDA%3AXAUUSD&interval=D&theme=dark&style=1&locale=es&toolbar_bg=f1f3f6&allow_symbol_change=0&enable_publishing=0&hide_side_toolbar=0&save_image=0&studies=[]&show_popup_button=0&calendar=0&hide_volume=1&amp;no-cache" 
                      frameborder="0" allowfullscreen>
              </iframe>
          </div>
          
      </div>
      
      <div class="notepad-panel">
          <h2>Bloc de Notas</h2>
          <textarea id="notepad" placeholder="Escribe tus notas aquí..."></textarea>
      </div>
      
    </main>

    <aside class="sidebar">
      <iframe class="video-frame" 
              src="https://www.youtube.com/embed/xVX50vBItfI" 
              title="YouTube video player 1" 
              frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
              allowfullscreen>
      </iframe>
      <iframe class="video-frame" 
              src="https://www.youtube.com/embed/B5pURXjg4Ew" 
              title="YouTube video player 2" 
              frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
              allowfullscreen>
      </iframe>
    </aside>
  </div>

  <script>
    // --- Lógica JavaScript ---
    
    // --- Calculadora --- (Se mantiene igual)
    const display = document.getElementById('display');
    let currentInput = '0';
    let previousInput = '';
    let operation = null;
    let waitingForSecondOperand = false;

    function updateDisplay() {
        display.textContent = currentInput.length > 15 ? currentInput.slice(0, 15) : currentInput;
    }

    function appendNumber(number) {
        if (waitingForSecondOperand) {
            currentInput = number;
            waitingForSecondOperand = false;
        } else {
            if (number === '.' && currentInput.includes('.')) return;
            currentInput = currentInput === '0' && number !== '.' ? number : currentInput + number;
        }
        updateDisplay();
    }

    function appendOperator(nextOperation) {
        const inputValue = parseFloat(currentInput);

        if (operation && waitingForSecondOperand) {
            operation = nextOperation;
            return;
        }

        if (previousInput === '') {
            previousInput = inputValue;
        } else if (operation) {
            const result = performCalculation[operation](previousInput, inputValue);
            currentInput = String(result);
            previousInput = result;
        }

        waitingForSecondOperand = true;
        operation = nextOperation;
        updateDisplay();
    }

    const performCalculation = {
        '/': (first, second) => first / second,
        '*': (first, second) => first * second,
        '+': (first, second) => first + second,
        '-': (first, second) => first - second,
        '=': (first, second) => second 
    };
    
    function calculate() {
        if (!operation || waitingForSecondOperand) return;
        
        const secondOperand = parseFloat(currentInput);
        
        if (operation === '=') {
             return;
        }

        const result = performCalculation[operation](previousInput, secondOperand);
        currentInput = String(result);
        operation = null;
        previousInput = '';
        waitingForSecondOperand = false;
        updateDisplay();
    }

    function clearDisplay() {
        currentInput = '0';
        previousInput = '';
        operation = null;
        waitingForSecondOperand = false;
        updateDisplay();
    }
    
    function backspace() {
        if (currentInput.length > 1 && !waitingForSecondOperand) {
            currentInput = currentInput.slice(0, -1);
        } else if (currentInput.length === 1 && !waitingForSecondOperand) {
            currentInput = '0';
        }
        updateDisplay();
    }
    
    updateDisplay(); 

    // --- Bloc de Notas Lógica (Guardado local) ---
    const notepad = document.getElementById('notepad');
    const savedNotes = localStorage.getItem('danifu_notes');
    if (savedNotes) {
        notepad.value = savedNotes;
    }

    notepad.addEventListener('input', () => {
        localStorage.setItem('danifu_notes', notepad.value);
    });

    // 1. SCRIPT DE FECHA Y HORA
    function actualizarFechaHora() {
      const ahora = new Date();
      document.getElementById("fecha-hora").textContent =
        ahora.toLocaleDateString() + " " + ahora.toLocaleTimeString();
    }
    setInterval(actualizarFechaHora, 1000);
    actualizarFechaHora();

    // 2. SCRIPT DE DÓLAR BLUE (Actualización automática)
    async function obtenerDolarBlue() {
      const dolarElement = document.getElementById("dolar");
      const antiCache = new Date().getTime(); 
      const url = `https://dolarapi.com/v1/dolares/blue?t=${antiCache}`;
      
      dolarElement.textContent = "Cargando..."; 
      
      try {
        const response = await fetch(url);
        if (!response.ok) {
          throw new Error(`Error HTTP: ${response.status}`);
        }
        const data = await response.json();
        const precioVenta = data.venta; 
        
        if (precioVenta) {
          if (precioVenta < 100) {
             dolarElement.textContent = "N/D (API error)";
          } else {
             dolarElement.textContent = precioVenta.toFixed(2);
          }
        } else {
          dolarElement.textContent = "N/D"; 
        }

      } catch (error) {
        console.error("Error al obtener el precio del dólar:", error);
        dolarElement.textContent = "1000.00"; 
      }
    }
    
    obtenerDolarBlue(); 
    setInterval(obtenerDolarBlue, 300000); // Actualiza cada 5 minutos (300000 ms)


    // 3. SCRIPT DE REPRODUCTOR DE MÚSICA ALEATORIO
    
    const playlist = [
        { name: "Pista 1: Musica Animada", file: "musica1.mp3" },
        { name: "Pista 2: Canción de Prueba", file: "musica2.mp3" },
        { name: "Pista 3: Final de Pista", file: "musica3.mp3" },
    ];
    
    const audioPlayer = document.getElementById('audioPlayer');
    const playPauseBtn = document.getElementById('playPauseBtn');
    const songNameElement = document.getElementById('song');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    
    let currentTrackIndex = -1; 
    // SOLUCIÓN: Usar minúsculas en la ruta.
    const MUSIC_FOLDER = "yt/"; 

    function getRandomTrackIndex(excludeIndex) {
        let newIndex;
        // Genera un índice aleatorio que NO sea el excluido, si hay más de una pista
        do {
            newIndex = Math.floor(Math.random() * playlist.length);
        } while (newIndex === excludeIndex && playlist.length > 1);
        return newIndex;
    }

    function loadTrack(index) {
        if (index === 'random') {
             index = getRandomTrackIndex(currentTrackIndex);
        } else if (typeof index === 'number') {
            // Asegura que el índice esté dentro del rango (manejo de ATRÁS secuencial)
             index = (index + playlist.length) % playlist.length;
        }
        
        currentTrackIndex = index;
        const track = playlist[currentTrackIndex];
        audioPlayer.src = MUSIC_FOLDER + track.file;
        songNameElement.textContent = track.name;
        audioPlayer.load();
    }
    
    function updatePlayPauseButton(isPlaying) {
        if (isPlaying) {
            playPauseBtn.innerHTML = '<i class="fa-solid fa-pause"></i> PAUSA';
            playPauseBtn.title = "Pausa";
        } else {
            playPauseBtn.innerHTML = '<i class="fa-solid fa-play"></i> REPRODUCIR';
            playPauseBtn.title = "Reproducir";
        }
    }

    function togglePlayPause() {
        if (audioPlayer.paused) {
            // Si es la primera vez que se presiona Play, carga una pista aleatoria
            if (currentTrackIndex === -1) {
                loadTrack('random');
            }
            audioPlayer.play().then(() => {
                updatePlayPauseButton(true);
            }).catch(error => {
                console.error("Error de reproducción (Autoplay bloqueado).", error);
                updatePlayPauseButton(false);
            });
        } else {
            audioPlayer.pause();
            updatePlayPauseButton(false);
        }
    }
    
    playPauseBtn.addEventListener('click', togglePlayPause);
    
    // Al presionar "Anterior" (ATRAS), va a la pista anterior secuencialmente
    prevBtn.addEventListener('click', () => {
        // Si no hay pista cargada, carga la última. Si sí, va a la anterior.
        let prevIndex = currentTrackIndex === -1 ? playlist.length - 1 : currentTrackIndex - 1;
        loadTrack(prevIndex);
        audioPlayer.play();
        updatePlayPauseButton(true); 
    });
    
    // Al presionar "Siguiente" (ADELANTE), va a una pista aleatoria
    nextBtn.addEventListener('click', () => {
        loadTrack('random');
        audioPlayer.play();
        updatePlayPauseButton(true); 
    });

    // Al finalizar una canción, reproduce la siguiente de forma aleatoria
    audioPlayer.addEventListener('ended', () => {
        loadTrack('random');
        audioPlayer.play(); 
    });

    // Muestra una canción al azar en la barra superior al cargar
    songNameElement.textContent = playlist[getRandomTrackIndex(-1)].name;
    updatePlayPauseButton(false);

  </script>
</body>
</html>
